---
title: "Unit 1 - Assignement"
author: "GT"
date: "16 avril 2016"
output: html_document
---

## AN ANALYTICAL DETECTIVE

### Problem 1 - Loading the Data

```{r}
Sys.setlocale("LC_ALL", "C")
mvt = read.csv("mvtWeek1.csv")
str(mvt)
summary(mvt)
```

How many observations ? **191641**

How many variables ? **11**

What is the maximum value of the variable "ID" ? **9181151**

What is the minimum value of the variable "Beat" ? **111**

How many obs have value TRUE in the "Arrest" variables ? **15536**

How many observations have a LocationDescription value of ALLEY ? **2308**

### Problem 2 - Understanding Dates in R

In what format are the entries in the variable Date ? **mm/dd/yy hh:mm**

```{r}
mvt$Date[1]
```

Let's convert these characters into a Date object in R.

```{r}
DateConvert = as.Date(strptime(mvt$Date, "%m/%d/%y %H:%M"))
summary(DateConvert)
```

What's the month of the year of the median date in the dataset ? **May 2006**

Let's extract the month and the day of the week, and add these variables to the data.

```{r}
mvt$Month = months(DateConvert)
mvt$Weekday = weekdays(DateConvert)
mvt$Date = DateConvert
table(mvt$Month)
table(mvt$Weekday)
table(mvt$Month, mvt$Arrest)
```

In which month did the fewest motor vehicle thefts occur ? **February**

On which weekday did the most motor vehicle thefts occur ? **Friday**

Which month has the largest number of motor vehicle thefts for which
an arrest was made ? **January**

### Problem 3 - Visualizing Crime Trends

Make a histogram of the variable Date. Add an extra argument, to specify the number of bars we want into histogram

```{r}
hist(mvt$Date, breaks=100)
```

Does it look like crime increase or decrease from 2002-2012 ? **Decrease**

Does it look like crime increase or decrease frome 2005-2008 ? **Decrease**

Does it look like crime increase or decrease from 2009-2011 ? **Increase**

Create a boxplot of the variable "Date", sorted by the variable "Arrest"

```{r}
boxplot(mvt$Date ~ mvt$Arrest)
```

Does it look like there were more crimes for which arrests were made in the first half of the time period or 
the second half ? **First half**

```{r}
table(mvt$Year, mvt$Arrest)
Arrest2001 = subset(mvt, mvt$Year == 2001 & mvt$Arrest == TRUE)
Total2001 = subset(mvt, mvt$Year == 2001)
nrow(Arrest2001)/nrow(Total2001)
Arrest2007 = subset(mvt, mvt$Year == 2007 & mvt$Arrest == TRUE)
Total2007 = subset(mvt, mvt$Year == 2007)
nrow(Arrest2007)/nrow(Total2007)
Arrest2012 = subset(mvt, mvt$Year == 2012 & mvt$Arrest == TRUE)
Total2012 = subset(mvt, mvt$Year == 2012)
nrow(Arrest2012)/nrow(Total2012)
```

For what proportion of motor vehicle thefts in 2001 was an arrest made? **0.104**

For what proportion of motor vehicle thefts in 2007 was an arrest made? **0.085**

For what proportion of motor vehicle thefts in 2012 was an arrest made? **0.039**

### Problem 4 - Popular Locations

Find the top five locations where motor vehicle thefts occur more by using the sort function:
**Street, Parking Lot/Garage (Non. Resid.), Alley, Gas Station, and Driveway - Residential**

```{r}
sort(table(mvt$LocationDescription),decreasing = TRUE)
```

Create a subset of your data, only taking observations for which the theft happened in one of these five
locations

```{r}
Top5 = subset(mvt, mvt$LocationDescription %in% c("STREET", "PARKING LOT/GARAGE(NON.RESID.)", "ALLEY", "GAS STATION", "DRIVEWAY - RESIDENTIAL"))
nrow(mvt)
nrow(Top5)
```

How many obs are in Top5 **177510**

R will remember the other categories of the LocationDescription variable from the orginal dataset. 
To make the tables nicer we can refresh this factor variable

```{r}
Top5$LocationDescription = factor(Top5$LocationDescription)
table(Top5$LocationDescription, Top5$Arrest)
table(Top5$Weekday, Top5$LocationDescription)
```
One of the locations has a much higher arrest rate than the other locations. Which is it ? **Gas Station**

On which day of the week do the most motor vehicle thefts at gas stations happen ? **Saturday**

On which day of the week do the fewest motor vehicle thefts in residential driveway happen? **Saturday**

## STOCK DYNAMICS

Download and read the files in R, using the read.csv() function. Each data frame has two variables, described
as follows:

  - **Date**: thedate of the stock price (first of the month)
  - **StockPrice**: the average stock price of the company in the given month

```{r}
IBM = read.csv("IBMStock.csv")
GE = read.csv("GEStock.csv")
ProcterGamble = read.csv("ProcterGambleStock.csv")
CocaCola = read.csv("CocaColaStock.csv")
Boeing = read.csv("BoeingStock.csv")
```

### Problem 1 - Summary Statistics

Look at the structure of the datasets. The date variable is stored as a factor. We can convert this to a "Date"
object in R

```{r}
str(IBM)
IBM$Date = as.Date(IBM$Date, "%m/%d/%y")
GE$Date = as.Date(GE$Date, "%m/%d/%y")
CocaCola$Date = as.Date(CocaCola$Date, "%m/%d/%y")
ProcterGamble$Date = as.Date(ProcterGamble$Date, "%m/%d/%y")
Boeing$Date = as.Date(Boeing$Date, "%m/%d/%y")
str(IBM)
summary(IBM)
summary(GE)
summary(CocaCola)
summary(Boeing)
sd(ProcterGamble$StockPrice)
```

The five datasets have the same number of observations. How many observations are there in each data set ?
**480**

What is the earliest year in the datasets? **1970**

What is the latest year in the datasets? **2009**

What is the mean stock price of IBM over this time period? **144.38**

What is the minimum stock price of GE over this time period? **9.294**

What is the maximum stock price of Coca-Cola over this time period? **146.58**

What is the median stock price of Boeing over this time period? **44.88**

What it the standard deviation of the stock price of Procter&Gamble over this time period? **18.194**

### Problem 2 - Visualizing Stock Dynamics

Plot the stock prices to see if we can visualize trends in stock prices during this time period. 
Add the argument type = "l" to plot a line intead of points

```{r}
plot(CocaCola$Date, CocaCola$StockPrice, type="l")
```

Around what year did Coca-cola has its highest stock price in this time period ? **1973**

Around what year did Coca/Cola has its lowest stock price in this time period ? **1980**

Let's add the line for Procter & Gamble too. Add the line to a plot in R by using the lines function.
Add a color for the lines to distinguish them. Draw a vertical line at a certain date with the function
abline()

```{r}
plot(CocaCola$Date, CocaCola$StockPrice, type="l", col="red")
lines(ProcterGamble$Date, ProcterGamble$StockPrice, col="blue")
abline(v=as.Date(c("2000-03-01")))
abline(v=as.Date(c("1983-01-01")))
```

In March of 2000, the technology bubble burst, and a stock market crash occurred. According to this plot,
which company's stock dropped more? **Procter & Gamble**

Around 1983, the stock for one of these companies (CocaCola or Procter & Gamble) was goinig up, while the
other was going down. Which one was going up? **Coca-Cola**

In the time period shown in the plot, which stock generally has lower values? **Coca-Cola**

### Problem 3 - Visualizing Stock Dynamics 1995-2005

Let's take a look at how the stock prices changed from 1995-2005 for all five companies.

```{r}
plot(CocaCola$Date[301:432], CocaCola$StockPrice[301:432],type="l",col="red",ylim=c(0,210))
lines(ProcterGamble$Date[301:432], ProcterGamble$StockPrice[301:432],col="blue")
lines(IBM$Date[301:432], IBM$StockPrice[301:432], col="green")
lines(GE$Date[301:432], GE$StockPrice[301:432], col="brown")
lines(Boeing$Date[301:432], Boeing$StockPrice[301:432], col="black")
abline(v=as.Date(c("2000-03-01")))
abline(v=as.Date(c("1997-10-01")))
```

Which stock fell the most right after thge technology bubble burst in March 2000? **GE**

Which stock reaches the highest value in the time period 1995-2005? **IBM**

In October 1997 there was a global stock market crash that was caused by an economic crisis in Asia.
comparing September 1997 to November 1997, which companies saw a decreasing trend in their stock price? 
**Procter & Gamble and Boeing**

In the last two years of this time period (2004 and 2005) which stock seems to be performing the best, in 
terms of increasing stock price? **Boeing**

### Problem 4 - Monthly Trends

Let's see if stocks tend to be higher or lower during certain months. Use the tapply command to calculate
the mean stock price of IBM, sorted by months.

```{r}
mean(IBM$StockPrice)
tapply(IBM$StockPrice, months(IBM$Date), mean)
```

In which months has IBM historically had a higher stock price? **Jan, Feb, Mar, Apr, May**

```{r}
tapply(CocaCola$StockPrice, months(CocaCola$Date), mean)
tapply(GE$StockPrice, months(GE$Date), mean)
tapply(ProcterGamble$StockPrice, months(ProcterGamble$Date), mean)
tapply(Boeing$StockPrice, months(Boeing$Date), mean)
```

GE and Coca-Cola both have their highest average stock price in the same month. Which month is this? **April**

For the months of December and January, every company's averages stock is higher in one month and lower in the 
other. In which month are the stock prices lower? **December**
