---
title: "TAE - Unit 4 - Recitation"
author: "GT"
date: "10 mai 2016"
output: html_document
---

## Location, Location, Location

In this recitation, we will be looking at regression trees, and applying them to data related
to house prices and locations.

### Boston Housing Data

In real estate, there is a famous saying that the most important thing is location, location, location.

Boston is the capital of the state of Massachusetts, USA. It was first settled in 1630, and in the
greater Boston area there are about 5 million people. The area features some of the highest population
densities in America.

In this recitation, we will be talking about Boston in a sense of the greater Boston area.
Over the greater Boston area, the nature of the housing varies widely.

This data comes from a paper, "Hedonic Housing Prices and the Demand for Clean Air," which
has been cited more than 1,000 times. This paper was written on a relationship between house
prices and clean air in the late 1970s by David Harrison of Harvard and Daniel Rubinfeld
of the University of Michigan.

The data set is widely used to evaluate algorithms of a nature we discuss in this class.

In the lecture, we mostly discuss *classification trees* with the output as a factor or a category.

Trees can also be used for regression tasks. The output at each leaf of a tree is no longer a category, 
but a number.

Just like classification trees, regression trees can capture nonlinearities that linear regression can't.

So what does that mean?

Well, with classification trees we report the average outcome at each leaf of our tree.

For example, if the outcome is true 15 times, and false 5 times, the value at that leaf of a tree would be
15/(15+5)=0.75. Now, if we use the default threshold of 0.5, we would say the value at this leaf is true.

With regression trees, we now have continuous variables. We report the average of the values at that leaf.

So suppose we had the values 3, 4, and 5 at one of the leaves of our trees. Well, we just take the average
of these numbers, which is 4, and that is what we report.

That might be a bit confusing so let's look at a picture.

```
  ^
  |   xxx
8 |  xxxx
  |   xx x                  x
6 |                          x xx x
  |                        x xxx
4 |           xxx
  |           xx x
2 |          x x x
  |
  |--------------------------------->
        10         20         30
```

So if we fit a linear regression to this data set, it does not do very well on this data set.

However, we can notice that the data lies in three different groups.
If we draw these lines here, we see x is either less than 10, between 10 and 20, or greater then 20,
and there is very different behavior in each group.

Regression trees can fit that kind of thing exactly. So the splits would be x is less than or equal to 10,
take the average of those values. x is between 10 and 20, take the average of those values. x is between 20 
and 30, take the average of those values.

We see that regression trees can fit some kinds of data very well that linear regression completely fails on.

In this recitation, we will explore the data set with the aid of trees. We will compare linear regression
with regression trees. We will discuss what the cp parameter means that we brought up when we did 
cross-validation in the lecture, and we will apply cross-validation to regression trees.

### The Data

- Each entry of this data set corresponds to a census **tract**, a statistical division of the area that
is used by researchers to break down towns and cities. 
- There will usually be multiple census tracts per **town**.
- **LON** and **LAT** are the longitude and latitude of the center of the census tract.
- **MEDV** is the median value of owner-occupied homes, measured in thousands of dollars.
- **CRIM** is the per capita crime rate. 
- **ZN** is related to how much of the land is zoned for large residential properties.
- **INDUS** is the proportion of the area used for industry.
- **CHAS** is 1 if a census tract is next to the Charles River.
- **NOX** is the concentration of nitrous oxides in the air, a measure of air pollution.
- **RM** is the average number of rooms per dwelling.
- **AGE** is the proportion of owner-occupied units built before 1940.
- **DIS** is a measure of how far the tract is from centers of employment in Boston.
- **RAD** is a measure of closeness to important highways.
- **TAX** is the property tax per $10,000 of value.
- **PTRATIO** is the pupil to teacher ratio by town.

So let's begin to analyze our data set with R. First of all, we'll load the data set into the Boston variable.
If we look at the structure of the Boston data set,we can see all the variables we talked about before.

```{r}
boston = read.csv("boston.csv")
str(boston)
```

There are 506 observations corresponding to 506 census tracts in the Greater Boston area.

We are interested in building a model initiallyof how prices vary by location across a region.

So let's first see how the points are laid out.Using the plot commands, we can plot the latitude and longitude
of each of our census tracts.

```{r}
plot(boston$LON, boston$LAT)
```

This picture might be a little bit meaningless to you if you're not familiar with the Massachusetts-Boston area,
but I can tell you that the dense central core of points corresponds to Boston city, Cambridge city, and 
other close urban cities.

So we want to show all the points that lie along the Charles River in a different color.
We have a variable, CHAS, that tells us if a point is on the Charles River or not.

```{r}
plot(boston$LON, boston$LAT)
points(boston$LON[boston$CHAS==1],boston$LAT[boston$CHAS==1], col="blue", pch=19)
```

So by running this command, you see we have some blue dots in our plot now. These are the census
tracts that lie along the Charles River. But maybe it's still a little bit confusing, and you'd like
to know where MIT is in this picture.

The census tract MIT is tract 3531. So let's plot that.

```{r}
plot(boston$LON, boston$LAT)
points(boston$LON[boston$CHAS==1],boston$LAT[boston$CHAS==1], col="blue", pch=19)
points(boston$LON[boston$TRACT==3531],boston$LAT[boston$TRACT==3531], col="red", pch=19)
```

Can you see it on the little picture? It's a little red dot, right in the middle.

What other things can we do?

Well, this data set was originally constructed to investigate questions about how air pollution 
affects prices. So the air pollution variable is this NOX variable. Let's have a look at a distribution
of NOX.

```{r}
summary(boston$NOX)
```

So we see that the minimum value is 0.385, the maximum value is 0.87 and t
he median and the mean are about 0.53, 0.55.
So let's just use the value of 0.55, as it's kind of in the middle. And we'll look at just the census
tracts that have above-average pollution.

```{r}
plot(boston$LON, boston$LAT)
points(boston$LON[boston$CHAS==1],boston$LAT[boston$CHAS==1], col="blue", pch=19)
points(boston$LON[boston$NOX>=0.55], boston$LAT[boston$NOX>=0.55], col="green", pch=19)
points(boston$LON[boston$TRACT==3531],boston$LAT[boston$TRACT==3531], col="red", pch=19)
```


So those are all the points that have got above-average pollution. Looks like my office is right
in the middle. Now it kind of makes sense, though, because that's the dense urban core of Boston.
If you think of anywhere where pollution would be, you'd think it'd be where the most cars and the 
most people are.

Now, before we do anything more, we should probably look at how prices vary over the area as well.
If we look at the distribution of the housing prices (boston$MEDV),

```{r}
summary(boston$MEDV)
```

we see that the minimum price, units are thousands of dollars, is around five,
the maximum is around 50.

So let's plot again only the above-average price points.

```{r}
plot(boston$LON, boston$LAT)
points(boston$LON[boston$MEDV>=21.2],boston$LAT[boston$MEDV>=21.2],col="red", pch=19)
```

So what we see now are all the census tracts with above-average housing prices.
As you can see, it's definitely not simple.

The census tracts of above-average and below-average are mixed in between each other.
So there's definitely some structure to it, but it's certainly not simple in relation
to latitude and longitude at least.

### Geographical Predictions
